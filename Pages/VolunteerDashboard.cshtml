@page
@model GoMad.Pages.VolunteerDashboardModel
@{
    ViewData["Title"] = "Panel de Voluntario";
    Layout = null; // Completamente independiente del layout de ancianos
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoMad - Panel de Voluntario</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body class="vol-body">

    <!-- Navbar exclusiva de voluntarios -->
    <nav class="vol-navbar">
        <div class="vol-navbar-brand">
            <img src="/Imagenes/GoMad%20logo.png" alt="GoMad" class="vol-navbar-logo" />
            <span class="vol-navbar-title">GoMad Voluntarios</span>
        </div>
        <div class="vol-navbar-links">
            <button class="vol-nav-link active" data-section="pedidos" onclick="showSection('pedidos')">ğŸ“‹ Pedidos</button>
            <button class="vol-nav-link" data-section="ruta" onclick="showSection('ruta')">ğŸ—ºï¸ Ruta</button>
        </div>
        <div class="vol-navbar-user">
            <span class="vol-navbar-email">@Model.VolunteerEmail</span>
            <form method="post" asp-page-handler="Logout" style="display:inline">
                <button type="submit" class="vol-nav-logout">Cerrar sesiÃ³n</button>
            </form>
        </div>
    </nav>

    <!-- Mobile bottom tabs -->
    <div class="vol-mobile-tabs">
        <button class="vol-mobile-tab active" data-section="pedidos" onclick="showSection('pedidos')">ğŸ“‹<span>Pedidos</span></button>
        <button class="vol-mobile-tab" data-section="ruta" onclick="showSection('ruta')">ğŸ—ºï¸<span>Ruta</span></button>
    </div>

    <div class="vol-main">

        <!-- ====== SECCIÃ“N: PEDIDOS ====== -->
        <section id="section-pedidos" class="vol-section active">
                    <div class="vol-section-header">
                        <h2>ğŸ“‹ Pedidos pendientes</h2>
                        <span class="vol-badge">@Model.Orders.Count pendientes</span>
                    </div>

                    <div class="vol-card-list">
                        @foreach(var o in Model.Orders)
                        {
                            <div class="vol-order-card pending">
                                <div class="vol-order-top">
                                    <span class="vol-order-status pending-status">â³ Pendiente</span>
                                </div>
                                <div class="vol-order-body">
                                    <p class="vol-order-address">ğŸ“ @o.Street, @o.PostalCode</p>
                                    <p class="vol-order-detail">ğŸ“ @o.Phone â€” Tipo: @o.Type</p>
                                </div>
                                <div class="vol-order-actions">
                                    <!-- No se permite aceptar/rechazar: todas las peticiones deben atenderse -->
                                    <button class="btn-vol-complete" onclick="completeOrder(this)">ğŸ‰ Marcar completado</button>
                                </div>
                            </div>
                        }
                    </div>
        </section>

        <!-- ====== SECCIÃ“N: RUTA ====== -->
        <section id="section-ruta" class="vol-section">
            <div class="vol-section-header">
                <h2>ğŸ—ºï¸ Mi ruta de hoy</h2>
            </div>

            <div class="vol-route-timeline">
                <p>La ruta se ha generado agrupando pedidos por supermercado y ordenando por cÃ³digo postal (optimizaciÃ³n simple).</p>
                @{
                    var idx = 1;
                }
                @foreach(var group in Model.RouteGroups)
                {
                    <div class="vol-route-group">
                        <h3>ğŸ“ @group.Key â€” Ir a este supermercado</h3>
                        <ul>
                        @foreach(var o in group.Value)
                        {
                            <li>
                                <strong>@idx.</strong> @o.Street, @o.PostalCode â€” ğŸ“ @o.Phone â€” Tipo: @o.Type
                                @{ idx++; }
                            </li>
                        }
                        </ul>
                    </div>
                }
            </div>
        </section>

    </div>

<script>
    // Section switching
    function showSection(name){
        document.querySelectorAll('.vol-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.vol-nav-link, .vol-mobile-tab').forEach(b => b.classList.remove('active'));
        document.getElementById('section-'+name).classList.add('active');
        document.querySelectorAll('[data-section="'+name+'"]').forEach(b => b.classList.add('active'));
    }

    // Order completion: volunteers must attend all requests; only allow marking as completed once served.
    function completeOrder(btn){
        var card = btn.closest('.vol-order-card');
        card.classList.remove('pending');
        card.classList.add('done');
        card.querySelector('.vol-order-status').textContent = 'ğŸ‰ Completado';
        card.querySelector('.vol-order-status').className = 'vol-order-status done-status';
        card.querySelector('.vol-order-actions').innerHTML = '';
        updateBadge();
    }
    function updateBadge(){
        var pending = document.querySelectorAll('.vol-order-card.pending').length;
        var badge = document.querySelector('.vol-badge');
        if(badge) badge.textContent = pending + ' pendiente' + (pending !== 1 ? 's' : '');
    }
</script>

</body>
</html>
